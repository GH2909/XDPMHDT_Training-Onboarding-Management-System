<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đổi Mật Khẩu - Employee</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../assets/css/pages/change-password.css">
</head>

<body>
    <!-- Header giống trang chính -->
    <header class="header">
        <div class="header-left">
            <a href="/employee/dashboard.html" class="logo">
                <i class="fas fa-book-reader"></i>
                UTH - LMS
            </a>
            <nav class="nav-icons">
                
                <a href="../courses/list.html" title="Khóa học">
                    <i class="fas fa-graduation-cap"></i>
                </a>
                <a href="../quiz/list.html" title="Quiz">
                    <i class="fas fa-question-circle"></i>
                </a>
                <a href="progress.html" title="Tiến độ">
                    <i class="fas fa-chart-line"></i>
                </a>
                <a href="certificates.html" title="Chứng chỉ">
                    <i class="fas fa-certificate"></i>
                </a>
                <a href="/shared/auth/login.html" class="nav-link" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </a>
            </nav>
        </div>
        <div class="header-right">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Tìm khóa học...">
            </div>
            <div class="user-menu">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <div class="password-card">
            <!-- Card Header -->
            <div class="card-header">
                <div class="header-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h2>Đổi Mật Khẩu</h2>
                <p class="subtitle">Cập nhật mật khẩu để bảo mật tài khoản của bạn</p>
            </div>

            <!-- Password Form -->
            <form class="password-form" onsubmit="handleSubmit(event)">
                <!-- Mật khẩu hiện tại -->
                <div class="form-group">
                    <label for="currentPassword">Mật khẩu hiện tại</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="currentPassword" class="form-input"
                            placeholder="Nhập mật khẩu hiện tại" required>
                        <button type="button" class="toggle-password" onclick="togglePassword('currentPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <!-- Mật khẩu mới -->
                <div class="form-group">
                    <label for="newPassword">Mật khẩu mới</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="newPassword" class="form-input" placeholder="Nhập mật khẩu mới"
                            required oninput="checkPasswordStrength()">
                        <button type="button" class="toggle-password" onclick="togglePassword('newPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <!-- Password strength indicator -->
                    <div class="password-strength">
                        <div class="strength-bar">
                            <div class="strength-fill" id="strengthFill"></div>
                        </div>
                        <span class="strength-text" id="strengthText">Độ mạnh mật khẩu</span>
                    </div>
                </div>

                <!-- Xác nhận mật khẩu mới -->
                <div class="form-group">
                    <label for="confirmPassword">Xác nhận mật khẩu mới</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="confirmPassword" class="form-input"
                            placeholder="Nhập lại mật khẩu mới" required oninput="checkPasswordMatch()">
                        <button type="button" class="toggle-password" onclick="togglePassword('confirmPassword')">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <span class="error-message" id="matchError"></span>
                </div>

                <!-- Password Requirements -->
                <div class="requirements-box">
                    <h4><i class="fas fa-info-circle"></i> Yêu cầu mật khẩu:</h4>
                    <ul id="requirementsList">
                        <li id="req-length"><i class="fas fa-circle"></i> Ít nhất 8 ký tự</li>
                        <li id="req-uppercase"><i class="fas fa-circle"></i> Có chữ hoa (A-Z)</li>
                        <li id="req-lowercase"><i class="fas fa-circle"></i> Có chữ thường (a-z)</li>
                        <li id="req-number"><i class="fas fa-circle"></i> Có số (0-9)</li>
                        <li id="req-special"><i class="fas fa-circle"></i> Có ký tự đặc biệt (!@#$%)</li>
                    </ul>
                </div>

                <!-- Action Buttons -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="window.location.href='index.html'">
                        <i class="fas fa-arrow-left"></i> Quay lại
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save
                    </button>
                </div>
            </form>
        </div>
    </main>

    <script>
        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.nextElementSibling;
            const icon = button.querySelector('i');

            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Check password strength
        function checkPasswordStrength() {
            const password = document.getElementById('newPassword').value;
            const strengthFill = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');

            let strength = 0;
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
            };

            // Update requirements UI
            updateRequirement('req-length', requirements.length);
            updateRequirement('req-uppercase', requirements.uppercase);
            updateRequirement('req-lowercase', requirements.lowercase);
            updateRequirement('req-number', requirements.number);
            updateRequirement('req-special', requirements.special);

            // Calculate strength
            Object.values(requirements).forEach(met => met && strength++);

            // Update strength bar
            const percentage = (strength / 5) * 100;
            strengthFill.style.width = percentage + '%';

            if (strength <= 2) {
                strengthFill.style.background = '#ef4444';
                strengthText.textContent = 'Yếu';
                strengthText.style.color = '#ef4444';
            } else if (strength === 3) {
                strengthFill.style.background = '#f59e0b';
                strengthText.textContent = 'Trung bình';
                strengthText.style.color = '#f59e0b';
            } else if (strength === 4) {
                strengthFill.style.background = '#10b981';
                strengthText.textContent = 'Tốt';
                strengthText.style.color = '#10b981';
            } else {
                strengthFill.style.background = '#059669';
                strengthText.textContent = 'Rất tốt';
                strengthText.style.color = '#059669';
            }
        }

        // Update requirement item
        function updateRequirement(id, met) {
            const element = document.getElementById(id);
            const icon = element.querySelector('i');

            if (met) {
                element.style.color = '#10b981';
                icon.classList.remove('fa-circle');
                icon.classList.add('fa-check-circle');
            } else {
                element.style.color = '#9ca3af';
                icon.classList.remove('fa-check-circle');
                icon.classList.add('fa-circle');
            }
        }

        // Check password match
        function checkPasswordMatch() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const matchError = document.getElementById('matchError');

            if (confirmPassword && newPassword !== confirmPassword) {
                matchError.textContent = '⚠️ Mật khẩu không khớp!';
                matchError.style.display = 'block';
                return false;
            } else {
                matchError.style.display = 'none';
                return true;
            }
        }

        // Handle form submit
        function handleSubmit(event) {
            event.preventDefault();

            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            // Validate
            if (newPassword !== confirmPassword) {
                alert('Mật khẩu xác nhận không khớp!');
                return;
            }

            // Check password strength
            if (newPassword.length < 8) {
                alert('Mật khẩu phải có ít nhất 8 ký tự!');
                return;
            }

            // Simulate API call
            alert('✅ Đổi mật khẩu thành công!\nBạn sẽ được chuyển về trang đăng nhập.');

            // Redirect to login
            setTimeout(() => {
                window.location.href = '/shared/auth/login.html';
            }, 1500);
        }
    </script>
    <script src="/shared/auth/auth.js"></script>
</body>

</html>